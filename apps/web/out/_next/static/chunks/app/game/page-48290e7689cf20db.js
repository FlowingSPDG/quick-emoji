(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[925],{4:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var r=s(4568);s(7620);let n=e=>{let{message:t="読み込み中...",size:s="medium",className:n=""}=e;return(0,r.jsxs)("div",{className:"loading ".concat(n),style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"2rem"},children:[(0,r.jsx)("div",{className:"".concat({small:"w-4 h-4",medium:"w-8 h-8",large:"w-12 h-12"}[s]," border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin"),style:{marginBottom:"1rem"}}),t&&(0,r.jsx)("p",{style:{margin:0,color:"var(--text-color)",fontSize:"small"===s?"0.9rem":"1rem"},children:t})]})}},826:(e,t,s)=>{"use strict";s.d(t,{U4:()=>r,cd:()=>i,gC:()=>n});let r=e=>e.length>0&&e.every(e=>["github","slack","discord","unicode"].includes(e)),n=e=>["easy","medium","hard","all"].includes(e),a={get:(e,t)=>{try{let s=window.localStorage.getItem(e);return s?JSON.parse(s):t}catch(e){return t}},set:(e,t)=>{try{window.localStorage.setItem(e,JSON.stringify(t))}catch(e){}},remove:e=>{try{window.localStorage.removeItem(e)}catch(e){}}},i={saveSettings:e=>a.set("game-settings",e),getSettings:()=>a.get("game-settings",null),saveSession:e=>a.set("current-session",e),getSession:()=>a.get("current-session",null),clearSession:()=>a.remove("current-session")}},2883:(e,t,s)=>{"use strict";s.d(t,{hS:()=>i,uE:()=>a});class r extends Error{constructor(e,t){super(t),this.status=e,this.name="ApiError"}}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat("http://localhost:8787").concat(e),n={headers:{"Content-Type":"application/json",...t.headers},...t};try{let e=await fetch(s,n);if(!e.ok){let t=await e.json().catch(()=>({error:"Unknown error"}));throw new r(e.status,t.error||"HTTP ".concat(e.status))}return await e.json()}catch(e){if(e instanceof r)throw e;throw new r(0,"Network error or server unreachable")}}let a={emoji:{getEmojis:e=>{let t=new URLSearchParams;(null==e?void 0:e.platforms)&&t.append("platforms",e.platforms.join(",")),(null==e?void 0:e.difficulty)&&t.append("difficulty",e.difficulty),(null==e?void 0:e.count)&&t.append("count",e.count.toString());let s=t.toString();return n("/api/emojis".concat(s?"?".concat(s):""))}},session:{start:e=>n("/api/session/start",{method:"POST",body:JSON.stringify(e)}),answer:e=>n("/api/session/answer",{method:"POST",body:JSON.stringify(e)}),end:e=>n("/api/session/end",{method:"POST",body:JSON.stringify(e)})},leaderboard:{getLeaderboard:(e,t)=>{let s=new URLSearchParams;e&&s.append("limit",e.toString()),t&&s.append("platform",t);let r=s.toString();return n("/api/leaderboard".concat(r?"?".concat(r):""))}}},i=e=>{if(e instanceof r)switch(e.status){case 400:return"入力データが無効です。再度お試しください。";case 404:return"リソースが見つかりません。";case 429:return"リクエストが多すぎます。しばらく待ってから再度お試しください。";case 500:return"サーバーエラーが発生しました。しばらく待ってから再度お試しください。";case 0:return"ネットワーク接続を確認してください。";default:return e.message||"予期しないエラーが発生しました。"}return"予期しないエラーが発生しました。"}},7541:(e,t,s)=>{"use strict";var r=s(3041);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},8211:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(4568),n=s(7620),a=s(7541),i=s(2883),o=s(826),c=s(4);function l(){let e=(0,a.useRouter)(),[t,s]=(0,n.useState)({sessionId:null,currentEmoji:null,currentQuestion:0,totalQuestions:0,timeLeft:30,score:0,answer:"",feedback:{type:null,message:""},gameStarted:!1,gameEnded:!1}),[l,d]=(0,n.useState)([]),[u,m]=(0,n.useState)(!1),[h,f]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{let t=o.cd.getSettings();if(!t)return e.push("/settings");m(!0);try{let e=await i.uE.session.start({settings:t});s(t=>({...t,sessionId:e.sessionId,totalQuestions:e.emojis.length,gameStarted:!0})),d(e.emojis),o.cd.saveSession({sessionId:e.sessionId,settings:t})}catch(e){f((0,i.hS)(e))}finally{m(!1)}})()},[e]);let g=(0,n.useCallback)(async()=>{if(t.sessionId)try{await i.uE.session.end({sessionId:t.sessionId}),o.cd.clearSession(),e.push("/result?sessionId=".concat(t.sessionId))}catch(e){f((0,i.hS)(e))}},[t.sessionId,e]),p=(0,n.useCallback)(()=>{s(e=>{let t=e.currentQuestion+1;return t>=e.totalQuestions?(g(),{...e,gameEnded:!0}):{...e,currentQuestion:t,currentEmoji:l[t],timeLeft:30,answer:"",feedback:{type:null,message:""}}})},[l,g]),y=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.answer;if(!t.sessionId||!t.currentEmoji)return;let r=30-t.timeLeft;try{let n=await i.uE.session.answer({sessionId:t.sessionId,emoji:t.currentEmoji.emoji,answer:e.trim(),timeSpent:r});s(e=>({...e,score:n.currentScore,feedback:{type:n.correct?"correct":"incorrect",message:n.correct?"正解！ (+".concat(n.currentScore-e.score,"点)"):"不正解。正解: ".concat(n.correctAnswers.join(", "))}})),setTimeout(p,2e3)}catch(e){f((0,i.hS)(e))}},[t.sessionId,t.currentEmoji,t.answer,t.timeLeft,p]);if((0,n.useEffect)(()=>{if(!t.gameStarted||t.gameEnded||t.timeLeft<=0)return;let e=setInterval(()=>{s(e=>e.timeLeft<=1?(y(""),{...e,timeLeft:0}):{...e,timeLeft:e.timeLeft-1})},1e3);return()=>clearInterval(e)},[t.gameStarted,t.gameEnded,t.timeLeft,y]),u)return(0,r.jsx)(c.A,{message:"ゲームを準備しています...",size:"large"});if(h)return(0,r.jsxs)("div",{className:"card",style:{maxWidth:"600px",margin:"2rem auto",textAlign:"center"},children:[(0,r.jsx)("div",{className:"error",children:h}),(0,r.jsx)("button",{className:"btn btn-primary",onClick:()=>e.push("/settings"),children:"設定に戻る"})]});if(!t.gameStarted)return(0,r.jsx)("div",{className:"loading",children:"ゲームを開始しています..."});let w=t.currentEmoji||l[0],j=(t.currentQuestion+1)/t.totalQuestions*100;return(0,r.jsxs)("div",{className:"game-container",children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",maxWidth:"600px"},children:[(0,r.jsxs)("div",{className:"score-display",children:["スコア: ",t.score]}),(0,r.jsx)("div",{className:"timer-display",children:t.timeLeft}),(0,r.jsxs)("div",{children:["問題 ",t.currentQuestion+1,"/",t.totalQuestions]})]}),(0,r.jsx)("div",{style:{width:"100%",maxWidth:"600px",height:"8px",backgroundColor:"var(--border-color)",borderRadius:"4px",overflow:"hidden"},children:(0,r.jsx)("div",{style:{width:"".concat(j,"%"),height:"100%",backgroundColor:"var(--primary-color)",transition:"width 0.3s ease"}})}),(0,r.jsx)("div",{className:"emoji-display",children:null==w?void 0:w.emoji}),(0,r.jsx)("input",{type:"text",className:"answer-input",placeholder:"shortcodeを入力...",value:t.answer,onChange:e=>{var t;return t=e.target.value,void s(e=>({...e,answer:t}))},onKeyPress:e=>{"Enter"===e.key&&t.answer.trim()&&y()},autoFocus:!0,disabled:!!t.feedback.type}),t.feedback.type&&(0,r.jsx)("div",{className:"feedback ".concat(t.feedback.type),children:t.feedback.message}),(0,r.jsxs)("div",{style:{display:"flex",gap:"1rem",justifyContent:"center"},children:[(0,r.jsx)("button",{className:"btn btn-primary",onClick:()=>y(),disabled:!t.answer.trim()||!!t.feedback.type,children:"回答"}),(0,r.jsx)("button",{className:"btn btn-secondary",onClick:()=>e.push("/settings"),children:"終了"})]})]})}},9150:(e,t,s)=>{Promise.resolve().then(s.bind(s,8211))}},e=>{e.O(0,[587,18,358],()=>e(e.s=9150)),_N_E=e.O()}]);